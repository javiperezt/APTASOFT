---
alwaysApply: true
---
# ESTRUCTURA DE DIRECTORIOS DEL PROYECTO

## ğŸ“ Ãrbol de Directorios

```
/
â”œâ”€â”€ pages/                          # PÃ¡ginas principales (vistas HTML/PHP)
â”‚   â”œâ”€â”€ inicio_dashboard.php       # Dashboard principal
â”‚   â”œâ”€â”€ obras.php                  # Listado de obras
â”‚   â”œâ”€â”€ obraDetail.php             # Detalle de una obra
â”‚   â”œâ”€â”€ obraManoObra.php          # Seguimiento mano de obra
â”‚   â”œâ”€â”€ obraMaterial.php          # Seguimiento material
â”‚   â”œâ”€â”€ obraExternos.php          # Seguimiento externos
â”‚   â”œâ”€â”€ obraArchivos.php          # GestiÃ³n de archivos
â”‚   â”œâ”€â”€ presupuestos.php          # Listado de presupuestos
â”‚   â”œâ”€â”€ presupuestoDetail.php     # Detalle de presupuesto
â”‚   â”œâ”€â”€ facturas.php              # Listado de facturas
â”‚   â”œâ”€â”€ facturaDetail.php         # Detalle de factura
â”‚   â”œâ”€â”€ gastos.php                # Listado de gastos
â”‚   â”œâ”€â”€ gastoDetail.php           # Detalle de gasto
â”‚   â”œâ”€â”€ empleados.php             # Listado de empleados
â”‚   â”œâ”€â”€ contactos.php             # Listado de contactos
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ backend/                       # LÃ³gica de negocio (procesamiento)
â”‚   â”œâ”€â”€ obras/
â”‚   â”‚   â”œâ”€â”€ obraCreate.php        # Crear nueva obra
â”‚   â”‚   â”œâ”€â”€ obraUpdate.php        # Actualizar obra
â”‚   â”‚   â”œâ”€â”€ obraDelete.php        # Eliminar obra
â”‚   â”‚   â”œâ”€â”€ obraAddParte.php      # AÃ±adir parte de trabajo
â”‚   â”‚   â””â”€â”€ certificacionFacturar.php
â”‚   â”‚
â”‚   â”œâ”€â”€ presupuestos/
â”‚   â”‚   â”œâ”€â”€ presupuestoCreate.php
â”‚   â”‚   â”œâ”€â”€ presupuestoUpdate.php
â”‚   â”‚   â””â”€â”€ presupuestoDelete.php
â”‚   â”‚
â”‚   â”œâ”€â”€ facturas/
â”‚   â”‚   â”œâ”€â”€ facturaCreate.php
â”‚   â”‚   â”œâ”€â”€ facturaUpdate.php
â”‚   â”‚   â”œâ”€â”€ facturaPagoAdd.php
â”‚   â”‚   â””â”€â”€ facturaPagoDelete.php
â”‚   â”‚
â”‚   â”œâ”€â”€ gastos/
â”‚   â”‚   â”œâ”€â”€ gastoCreate.php
â”‚   â”‚   â”œâ”€â”€ gastoUpdate.php
â”‚   â”‚   â”œâ”€â”€ gastoUploadDocs.php   # Subir documentos
â”‚   â”‚   â”œâ”€â”€ gastoDeleteDoc.php    # Eliminar documento
â”‚   â”‚   â””â”€â”€ gastoPagoAdd.php
â”‚   â”‚
â”‚   â”œâ”€â”€ empleados/
â”‚   â”œâ”€â”€ contactos/
â”‚   â””â”€â”€ calendario/
â”‚       â”œâ”€â”€ addEvent.php
â”‚       â””â”€â”€ get-events.php
â”‚
â”œâ”€â”€ components/                    # Componentes reutilizables PHP
â”‚   â”œâ”€â”€ navbar.php                # Barra de navegaciÃ³n
â”‚   â”œâ”€â”€ modals/                   # Modales Bootstrap
â”‚   â”‚   â”œâ”€â”€ obraNew.php
â”‚   â”‚   â”œâ”€â”€ obraDelete.php
â”‚   â”‚   â”œâ”€â”€ facturaNew.php
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ obras/                    # Componentes especÃ­ficos de obras
â”‚   â”‚   â”œâ”€â”€ obraLine.php         # LÃ­nea de tabla de obra
â”‚   â”‚   â”œâ”€â”€ certificacionLine.php
â”‚   â”‚   â””â”€â”€ navObra.php
â”‚   â”‚
â”‚   â”œâ”€â”€ facturas/
â”‚   â”‚   â”œâ”€â”€ facturaLine.php
â”‚   â”‚   â”œâ”€â”€ facturaPartidaLine.php
â”‚   â”‚   â””â”€â”€ facturaPagoLine.php
â”‚   â”‚
â”‚   â”œâ”€â”€ gastos/
â”‚   â”‚   â”œâ”€â”€ gastoLine.php
â”‚   â”‚   â””â”€â”€ gastoDocLine.php
â”‚   â”‚
â”‚   â””â”€â”€ noDataLine.php           # Mensaje "sin datos"
â”‚
â”œâ”€â”€ docs/                         # Documentos subidos
â”‚   â”œâ”€â”€ obras/
â”‚   â”‚   â””â”€â”€ {id_obra}/           # Documentos por obra
â”‚   â”‚       â”œâ”€â”€ archivo1.pdf
â”‚   â”‚       â””â”€â”€ archivo2.jpg
â”‚   â”‚
â”‚   â”œâ”€â”€ gastos/
â”‚   â”‚   â””â”€â”€ {id_gasto}/          # Facturas recibidas
â”‚   â”‚       â””â”€â”€ factura.pdf
â”‚   â”‚
â”‚   â””â”€â”€ facturas/                # Facturas emitidas
â”‚
â”œâ”€â”€ css/                          # Estilos personalizados
â”‚   â””â”€â”€ style.css                # CSS custom (mÃ­nimo)
â”‚
â”œâ”€â”€ js/                           # JavaScript vanilla
â”‚   â”œâ”€â”€ main.js
â”‚   â””â”€â”€ calendar.js
â”‚
â”œâ”€â”€ img/                          # ImÃ¡genes y recursos
â”‚   â”œâ”€â”€ logoApta.png
â”‚   â”œâ”€â”€ logoSirecons.jpg
â”‚   â””â”€â”€ logoEpicas.png
â”‚
â”œâ”€â”€ conexion.php                  # â­ ConexiÃ³n a MySQL
â”œâ”€â”€ authCookieSessionValidate.php # â­ ValidaciÃ³n de autenticaciÃ³n
â”œâ”€â”€ links_header.php              # â­ Links comunes (Bootstrap, CSS, JS)
â”œâ”€â”€ ConsecutiveNumbers.php        # Clase para numeraciÃ³n automÃ¡tica
â””â”€â”€ index.php                     # Login
```

---

## ğŸ“‹ CONVENCIONES DE NOMBRES

### Archivos en pages/
- **Formato:** `camelCase.php`
- **Ejemplos:** `obraDetail.php`, `facturaDetail.php`, `inicio_dashboard.php`
- **FunciÃ³n:** PÃ¡ginas completas con HTML que el usuario ve

### Archivos en backend/
- **Formato:** `moduloAccion.php`
- **Ejemplos:** `obraCreate.php`, `facturaUpdate.php`, `gastoDelete.php`
- **FunciÃ³n:** Procesan datos (INSERT, UPDATE, DELETE) y redirigen
- **NO devuelven HTML**, solo lÃ³gica de negocio

### Archivos en components/
- **Formato:** `moduloComponente.php`
- **Ejemplos:** `obraLine.php`, `facturaNew.php`
- **FunciÃ³n:** Fragmentos HTML reutilizables que se incluyen en pÃ¡ginas

---

## ğŸ”„ FLUJO DE TRABAJO

### 1. Usuario accede a una pÃ¡gina
```
Usuario â†’ pages/obraDetail.php
```

### 2. PÃ¡gina carga datos y componentes
```php
<?php
session_start();
include "../conexion.php";               // â­ ConexiÃ³n BD
require_once "../authCookieSessionValidate.php"; // â­ AutenticaciÃ³n
?>
<html>
<head>
    <?php include "../links_header.php"; ?> <!-- â­ Bootstrap, CSS, JS -->
</head>
<body>
<?php include "../components/navbar.php"; ?> <!-- NavegaciÃ³n -->

</body>
</html>
```

---

## ğŸ“ RUTAS IMPORTANTES

### Rutas relativas desde pages/
```php
include "../conexion.php";                    // ConexiÃ³n
include "../components/navbar.php";           // Componente
include "../links_header.php";                // Links
```

### Rutas relativas desde backend/
```php
include "../../conexion.php";                 // ConexiÃ³n
```

---

## ğŸ¯ ARCHIVOS CLAVE DEL SISTEMA

### 1. conexion.php
```php
// Establece la variable global $mysqli
// Usado en TODAS las pÃ¡ginas y backend
```

### 2. authCookieSessionValidate.php
```php
// Valida si el usuario estÃ¡ autenticado
// Establece la variable $isLoggedIn
```

### 3. links_header.php
```php
// Incluye todos los CSS y JS necesarios:
// - Bootstrap 5
// - Bootstrap Icons
// - Estilos custom
```

### 4. ConsecutiveNumbers.php
```php
// Clase para generar nÃºmeros consecutivos
// Usado en presupuestos (E240001) y facturas (F240001)
```

---

## ğŸš« QUÃ‰ NO HACER

âŒ **NO crear pÃ¡ginas fuera de pages/**
âŒ **NO poner lÃ³gica de negocio en pages/** (solo vistas)
âŒ **NO poner HTML en backend/** (solo procesamiento)
âŒ **NO hardcodear rutas absolutas**
âŒ **NO crear subdirectorios personalizados** sin consultar la estructura

---

## âœ… QUÃ‰ SÃ HACER

âœ… **Respetar la estructura de carpetas**
âœ… **Usar rutas relativas correctas**
âœ… **Separar vistas (pages) de lÃ³gica (backend)**
âœ… **Reutilizar componentes de components/**
âœ… **Seguir el patrÃ³n de nombrado establecido**
âœ… **Incluir siempre conexion.php y authCookieSessionValidate.php en pÃ¡ginas**